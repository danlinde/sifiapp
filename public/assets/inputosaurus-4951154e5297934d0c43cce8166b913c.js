!function(e){var t={version:"0.1.6",eventprefix:"inputosaurus",options:{inputDelimiters:[",",";"],outputDelimiter:",",allowDuplicates:!1,parseOnBlur:!1,wrapperElement:null,width:null,autoCompleteSource:"",activateFinalResult:!1,parseHook:null},_create:function(){var t=this,i={},n=t.options;this._chosenValues=[],i.ul=e('<ul class="inputosaurus-container">'),i.input=e('<input type="text" />'),i.inputCont=e('<li class="inputosaurus-input inputosaurus-required"></li>'),i.origInputCont=e('<li class="inputosaurus-input-hidden inputosaurus-required">'),n.wrapperElement&&n.wrapperElement.append(i.ul),this.element.replaceWith(n.wrapperElement||i.ul),i.origInputCont.append(this.element).hide(),i.inputCont.append(i.input),i.ul.append(i.inputCont),i.ul.append(i.origInputCont),n.width&&i.ul.css("width",n.width),this.elements=i,t._attachEvents(),e.trim(this.element.val())&&(i.input.val(this.element.val()),this.parseInput()),this._instAutocomplete()},_instAutocomplete:function(){if(this.options.autoCompleteSource){var t=this;this.elements.input.autocomplete({position:{of:this.elements.ul},source:this.options.autoCompleteSource,minLength:1,select:function(e,i){e.preventDefault(),t.elements.input.val(i.item.value),t.parseInput()},open:function(){var i,n=e(this).data("autocomplete").menu;n.element.width(t.elements.ul.outerWidth()),t.options.activateFinalResult&&(i=n.element.find("li"),1===i.size()&&n[n.activate?"activate":"focus"](e.Event("click"),i))}})}},_autoCompleteMenuPosition:function(){var e;this.options.autoCompleteSource&&(e=this.elements.input.data("autocomplete"),e&&e.menu.element.position({of:this.elements.ul,my:"left top",at:"left bottom",collision:"none"}))},parseInput:function(t){var i,n=t&&t.data.widget||this,s=!1,u=[];i=n.elements.input.val(),i&&(s=n._containsDelimiter(i)),s!==!1?u=i.split(s):t&&(t.which!==e.ui.keyCode.ENTER||e(".ui-menu-item .ui-state-focus").size()||e("#ui-active-menuitem").size())?"blur"!==t.type||e("#ui-active-menuitem").size()||u.push(i):(u.push(i),t&&t.preventDefault()),e.isFunction(n.options.parseHook)&&(u=n.options.parseHook(u)),u.length&&(n._setChosen(u),n.elements.input.val(""),n._resizeInput())},_inputFocus:function(e){var t=e.data.widget||this;t.elements.input.value||t.options.autoCompleteSource.length&&t.elements.input.autocomplete("search","")},_inputKeypress:function(t){var i=t.data.widget||this;switch("keyup"===t.type&&i._trigger("keyup",t,i),t.which){case e.ui.keyCode.BACKSPACE:"keydown"===t.type&&i._inputBackspace(t);break;case e.ui.keyCode.LEFT:"keydown"===t.type&&i._inputBackspace(t);break;default:i.parseInput(t),i._resizeInput(t)}i.options.autoCompleteSource&&setTimeout(function(){i._autoCompleteMenuPosition.call(i)},200)},_resizeInput:function(e){var t=e&&e.data.widget||this,i=t.elements.ul.width(),n=t.elements.input.val(),s=25+8*n.length;t.elements.input.width(i>s?s:i)},_inputBackspace:function(t){var i=t&&t.data.widget||this;lastTag=i.elements.ul.find("li:not(.inputosaurus-required):last"),t.stopPropagation(),(!e(t.currentTarget).val()||"selectionStart"in t.currentTarget&&0===t.currentTarget.selectionStart&&0===t.currentTarget.selectionEnd)&&lastTag.size()&&(t.preventDefault(),lastTag.find("a").focus())},_editTag:function(t){var i=t&&t.data.widget||this,n="",s=e(t.currentTarget).closest("li").data("inputosaurus");return s?(t.preventDefault(),e.each(i._chosenValues,function(e,t){t.key===s&&(n=t.value)}),i.elements.input.val(n),i._removeTag(t),i._resizeInput(t),void 0):!0},_tagKeypress:function(t){var i=t.data.widget;switch(t.which){case e.ui.keyCode.BACKSPACE:t&&t.preventDefault(),t&&t.stopPropagation(),e(t.currentTarget).trigger("click");break;case 69:i._editTag(t);break;case e.ui.keyCode.LEFT:"keydown"===t.type&&i._prevTag(t);break;case e.ui.keyCode.RIGHT:"keydown"===t.type&&i._nextTag(t);break;case e.ui.keyCode.DOWN:"keydown"===t.type&&i._focus(t)}},_prevTag:function(t){var i=t&&t.data.widget||this,n=e(t.currentTarget).closest("li"),s=n.prev();s.is("li")?s.find("a").focus():i._focus()},_nextTag:function(t){var i=t&&t.data.widget||this,n=e(t.currentTarget).closest("li"),s=n.next();s.is("li:not(.inputosaurus-input)")?s.find("a").focus():i._focus()},_containsDelimiter:function(t){var i=!1;return e.each(this.options.inputDelimiters,function(e,n){-1!==t.indexOf(n)&&(i=n)}),i},_setChosen:function(t){var i=this;return e.isArray(t)?(e.each(t,function(t,n){var s=!1,u={key:"",value:""};n=e.trim(n),e.each(i._chosenValues,function(e,t){t.value===n&&(s=!0)}),""===n||s&&!i.options.allowDuplicates||(u.key="mi_"+Math.random().toString(16).slice(2,10),u.value=n,i._chosenValues.push(u),i._renderTags())}),i._setValue(i._buildValue()),void 0):!1},_buildValue:function(){var t=this,i="";return e.each(this._chosenValues,function(e,n){i+=i.length?t.options.outputDelimiter+n.value:n.value}),i},_setValue:function(e){var t=this.element.val();t!==e&&(this.element.val(e),this._trigger("change"))},_createTag:function(t,i,n){return n=n?' class="'+n+'"':"",void 0!==t?e("<li"+n+' data-inputosaurus="'+i+'"><span>'+t+'</span> <a href="javascript:void(0);" class="ficon">&#x2716;</a></li>'):void 0},_renderTags:function(){var t=this;this.elements.ul.find("li:not(.inputosaurus-required)").remove(),e.each(this._chosenValues,function(e,i){var n=t._createTag(i.value,i.key);t.elements.ul.find("li.inputosaurus-input").before(n)})},_removeTag:function(t){var i=e(t.currentTarget).closest("li").data("inputosaurus"),n=!1,s=t&&t.data.widget||this;e.each(s._chosenValues,function(e,t){i===t.key&&(n=e)}),n!==!1&&s._chosenValues.splice(n,1),s._setValue(s._buildValue()),e(t.currentTarget).closest("li").remove(),s.elements.input.focus()},_focus:function(t){var i=t&&t.data.widget||this;t&&e(t.target).closest("li").data("inputosaurus")||i.elements.input.focus()},_tagFocus:function(t){e(t.currentTarget).parent()["focusout"===t.type?"removeClass":"addClass"]("inputosaurus-selected")},refresh:function(){var t=this.options.outputDelimiter,i=this.element.val(),n=[];n.push(i),t&&(n=i.split(t)),n.length&&(this._chosenValues=[],e.isFunction(this.options.parseHook)&&(n=this.options.parseHook(n)),this._setChosen(n),this._renderTags(),this.elements.input.val(""),this._resizeInput())},_attachEvents:function(){var e=this;this.elements.input.on("keyup.inputosaurus",{widget:e},this._inputKeypress),this.elements.input.on("keydown.inputosaurus",{widget:e},this._inputKeypress),this.elements.input.on("change.inputosaurus",{widget:e},this._inputKeypress),this.elements.input.on("focus.inputosaurus",{widget:e},this._inputFocus),this.options.parseOnBlur&&this.elements.input.on("blur.inputosaurus",{widget:e},this.parseInput),this.elements.ul.on("click.inputosaurus",{widget:e},this._focus),this.elements.ul.on("click.inputosaurus","a",{widget:e},this._removeTag),this.elements.ul.on("dblclick.inputosaurus","li",{widget:e},this._editTag),this.elements.ul.on("focus.inputosaurus","a",{widget:e},this._tagFocus),this.elements.ul.on("blur.inputosaurus","a",{widget:e},this._tagFocus),this.elements.ul.on("keydown.inputosaurus","a",{widget:e},this._tagKeypress)},_destroy:function(){this.elements.input.unbind(".inputosaurus"),this.elements.ul.replaceWith(this.element)}};e.widget("ui.inputosaurus",t)}(jQuery);