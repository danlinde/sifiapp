(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};WebSocketRails.WebSocketConnection=function(){function e(e,s){this.url=e,this.dispatcher=s,this.flush_queue=t(this.flush_queue,this),this.on_error=t(this.on_error,this),this.on_close=t(this.on_close,this),this.on_message=t(this.on_message,this),this.trigger=t(this.trigger,this),this.url.match(/^wss?:\/\//)?console.log("WARNING: Using connection urls with protocol specified is depricated"):this.url="http:"===window.location.protocol?"ws://"+this.url:"wss://"+this.url,this.message_queue=[],this._conn=new WebSocket(this.url),this._conn.onmessage=this.on_message,this._conn.onclose=this.on_close,this._conn.onerror=this.on_error}return e.prototype.trigger=function(t){return"connected"!==this.dispatcher.state?this.message_queue.push(t):this._conn.send(t.serialize())},e.prototype.on_message=function(t){var e;return e=JSON.parse(t.data),this.dispatcher.new_message(e)},e.prototype.on_close=function(t){var e;return e=new WebSocketRails.Event(["connection_closed",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(e)},e.prototype.on_error=function(t){var e;return e=new WebSocketRails.Event(["connection_error",t]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(e)},e.prototype.flush_queue=function(){var t,e,s,n;for(n=this.message_queue,e=0,s=n.length;s>e;e++)t=n[e],this._conn.send(t.serialize());return this.message_queue=[]},e}()}).call(this);